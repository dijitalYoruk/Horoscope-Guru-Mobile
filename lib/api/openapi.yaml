openapi: 3.0.3
info:
  title: Horoscope Guru
  version: 1.0.0
paths:

  /auth/google/sign-in:
    get:
      summary: Google OAuth callback endpoint
      operationId: signInGoogle
      parameters:
        - name: idToken
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoogleSignInResponse'

  /chat/start:
    post:
      security:
        - bearerAuth: []
      summary: Starts a chat and saves it to the db.
      operationId: startChat
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartChatRequest'
      responses:
        '200':
          description: "StartChatResponse"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StartChatResponse'

  /chat:
    post:
      security:
        - bearerAuth: []
      summary: Sends a user message and retrieves the new assistant message.
      operationId: sendMessageToChat
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostChatRequest'
      responses:
        '200':
          description: "PostChatResponse"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostChatResponse'

  /chat/{chatId}/generate/title:
    get:
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: "GenerateChatTitleResponse"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerateChatTitleResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    GoogleSignInResponse:
      type: object
      required:
        - token
        - user
      properties:
        token:
          type: string
          description: JWT token for authentication
        user:
          $ref: '#/components/schemas/User'

    GoogleSignInRequest:
      type: object
      required:
        - idToken
      properties:
        idToken:
          type: string

    User:
      type: object
      required:
        - id
        - email
        - name
        - surname
      properties:
        id:
          type: string
        email:
          type: string
        name:
          type: string
        surname:
          type: string

    PostChatRequest:
      type: object
      required:
        - message
      properties:
        initialMessage:
          allOf:
           - $ref: '#/components/schemas/ChatMessage'
          nullable: true
        chatId:
          type: string
        message:
          type: string

    PostChatResponse:
      type: object
      required:
        - chatId
        - message
      properties:
        chatId:
          type: string
        message:
          $ref: '#/components/schemas/ChatMessage'

    GenerateChatTitleResponse:
      type: object
      required:
        - title
      properties:
        title:
          type: string

    StartChatRequest:
      type: object

    StartChatResponse:
      type: object
      required:
        - message
      properties:
        message:
          $ref: '#/components/schemas/ChatMessage'

    ChatMessage:
      type: object
      required:
        - role
        - content
        - updatedAt
      properties:
        role:
          $ref: '#/components/schemas/ChatMessageRole'
        content:
          type: string
        updatedAt:
          type: string
          format: date-time

    ChatMessageRole:
      type: string
      enum:
        - "assistant"
        - "system"
        - "user"
